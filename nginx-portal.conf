server {
    listen 80;
    server_name localhost;

    # This location handles the root URL, redirecting to your app's entry point.
    # This is the only external redirect.
    location = / {
        return 301 /portal/stories/;
    }

    # This location block handles the entire Single Page Application.
    location /portal/stories/ {
        # The 'alias' directive is the key to this solution. It maps a URL location
        # to a different directory on the filesystem. Here, any request starting
        # with /portal/stories/ will look for files inside /usr/share/nginx/html/.
        # Nginx automatically strips the matching location part from the path.
        # e.g., a request for /portal/stories/main.js will look for the file
        # /usr/share/nginx/html/main.js.
        alias /usr/share/nginx/html/;

        # try_files is used to correctly serve assets or the main index.html for SPA routing.
        # 1. It first tries to find a file or directory matching the exact URI.
        #    This correctly serves assets like main.js and styles.css.
        # 2. If no file/dir is found (e.g., for a deep link like /portal/stories/some/page),
        #    it falls back to making an internal subrequest for /portal/stories/index.html.
        #    This subrequest is then handled by this same location block, which finds and
        #    serves the index.html file, allowing the client-side router to take over.
        # This approach avoids rewrite loops.
        try_files $uri $uri/ /portal/stories/index.html;
    }

    # Your health check endpoint remains unchanged.
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}

server {
    listen 80;
    server_name localhost;

    # The root directory where your application's files are located.
    # Your Dockerfile correctly copies files here.
    root /usr/share/nginx/html;

    # This location handles the root URL, redirecting to your app's entry point.
    location = / {
        return 301 /portal/stories/;
    }

    # This block specifically handles rewriting the URL.
    # It catches any request under /portal/stories/, strips that prefix,
    # and tells Nginx to find a new location to handle the rewritten URL.
    location /portal/stories/ {
        rewrite ^/portal/stories/(.*)$ /$1 last;
    }

    # This block acts as the main file server for your application.
    # It will handle the rewritten URLs from the block above.
    location / {
        # try_files is the key to making SPAs work.
        # 1. It first tries to find a file matching the exact URI (e.g., /main.js, /styles.css).
        #    If found, it serves the asset directly. This is how your JS and CSS will load correctly.
        # 2. If it doesn't find a file, it falls back to serving /index.html.
        #    This allows your client-side router to handle deep links (e.g., /some/page).
        try_files $uri $uri/ /index.html;
    }

    # Your health check endpoint remains unchanged.
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
